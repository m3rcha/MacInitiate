import type { SystemTweak, TweakCategory, TweakFilters, TweakCategoryId } from '@/types/tweaks'

export const TWEAK_CATEGORIES: Record<TweakCategoryId, TweakCategory> = {
    appearance: {
        id: 'appearance',
        name: 'Appearance & Display',
        icon: 'ðŸŽ¨',
        description: 'Visual settings and display preferences',
        order: 1,
    },
    input: {
        id: 'input',
        name: 'Input & Interaction',
        icon: 'âŒ¨ï¸',
        description: 'Keyboard, mouse, and touch interaction settings',
        order: 2,
    },
    security: {
        id: 'security',
        name: 'Security & Privacy',
        icon: 'ðŸ”’',
        description: 'Security settings and privacy protections',
        order: 3,
    },
    dock: {
        id: 'dock',
        name: 'Dock & Navigation',
        icon: 'ðŸš¢',
        description: 'Dock behavior and navigation preferences',
        order: 4,
    },
    finder: {
        id: 'finder',
        name: 'Finder & Files',
        icon: 'ðŸ“',
        description: 'File management and Finder preferences',
        order: 5,
    },
    safari: {
        id: 'safari',
        name: 'Safari & Web',
        icon: 'ðŸŒ',
        description: 'Safari browser settings and web preferences',
        order: 6,
    },
    terminal: {
        id: 'terminal',
        name: 'Terminal & Shell',
        icon: 'ðŸ’»',
        description: 'Terminal, shell, and command line preferences',
        order: 7,
    },
    development: {
        id: 'development',
        name: 'Developer Tools',
        icon: 'âš¡',
        description: 'Development environment and tool preferences',
        order: 8,
    },
}

export const SYSTEM_TWEAKS: SystemTweak[] = [
    // Appearance & Display
    {
        id: 'show-hidden-files',
        name: 'Show Hidden Files in Finder',
        description: 'Display files and folders starting with a dot (.) in Finder',
        category: TWEAK_CATEGORIES.appearance,
        subcategory: 'finder-visibility',
        tags: ['finder', 'files', 'hidden', 'visibility'],
        domain: 'com.apple.finder',
        key: 'AppleShowAllFiles',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write com.apple.finder AppleShowAllFiles -bool ${value}`,
        requiresRestart: true,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Shows hidden system files and folders in Finder. Useful for developers and power users.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'dark-mode-menubar',
        name: 'Dark Menu Bar and Dock',
        description: 'Enable dark appearance for menu bar and dock',
        category: TWEAK_CATEGORIES.appearance,
        subcategory: 'theme',
        tags: ['dark-mode', 'menu-bar', 'dock', 'appearance'],
        domain: 'NSGlobalDomain',
        key: 'AppleInterfaceStyle',
        valueType: 'string',
        defaultValue: null,
        command: (value) => value ? 'defaults write NSGlobalDomain AppleInterfaceStyle -string "Dark"' : 'defaults delete NSGlobalDomain AppleInterfaceStyle',
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.14',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'medium',
        documentation: 'Enables dark mode for the menu bar, dock, and built-in apps.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'auto-hide-dock',
        name: 'Auto-hide Dock',
        description: 'Automatically hide and show the dock',
        category: TWEAK_CATEGORIES.dock,
        subcategory: 'behavior',
        tags: ['dock', 'auto-hide', 'screen-space'],
        domain: 'com.apple.dock',
        key: 'autohide',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write com.apple.dock autohide -bool ${value} && killall Dock`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Hides the dock when not in use to maximize screen space.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'dock-magnification',
        name: 'Dock Magnification',
        description: 'Enable dock icon magnification on hover',
        category: TWEAK_CATEGORIES.dock,
        subcategory: 'behavior',
        tags: ['dock', 'magnification', 'hover'],
        domain: 'com.apple.dock',
        key: 'magnification',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write com.apple.dock magnification -bool ${value} && killall Dock`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Makes dock icons larger when you hover over them.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'dock-size',
        name: 'Dock Size',
        description: 'Set dock icon size (default: 48, range: 16-128)',
        category: TWEAK_CATEGORIES.dock,
        subcategory: 'appearance',
        tags: ['dock', 'size', 'icons'],
        domain: 'com.apple.dock',
        key: 'tilesize',
        valueType: 'integer',
        defaultValue: 48,
        command: (value) => `defaults write com.apple.dock tilesize -int ${value} && killall Dock`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Adjusts the size of dock icons. Larger values make icons bigger.',
        lastVerified: '2024-01-15',
    },

    // Input & Interaction
    {
        id: 'key-repeat-rate',
        name: 'Fast Key Repeat Rate',
        description: 'Set keyboard repeat rate to faster (default: 2, fast: 1)',
        category: TWEAK_CATEGORIES.input,
        subcategory: 'keyboard',
        tags: ['keyboard', 'repeat', 'typing'],
        domain: 'NSGlobalDomain',
        key: 'KeyRepeat',
        valueType: 'integer',
        defaultValue: 2,
        command: (value) => `defaults write NSGlobalDomain KeyRepeat -int ${value}`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Controls how fast characters repeat when holding a key. Lower values are faster.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'key-repeat-delay',
        name: 'Short Key Repeat Delay',
        description: 'Reduce delay before key repeat starts (default: 15, fast: 10)',
        category: TWEAK_CATEGORIES.input,
        subcategory: 'keyboard',
        tags: ['keyboard', 'delay', 'typing'],
        domain: 'NSGlobalDomain',
        key: 'InitialKeyRepeat',
        valueType: 'integer',
        defaultValue: 15,
        command: (value) => `defaults write NSGlobalDomain InitialKeyRepeat -int ${value}`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Sets the delay before key repeat begins. Lower values start repeating faster.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'tap-to-click',
        name: 'Tap to Click',
        description: 'Enable tap to click on trackpad',
        category: TWEAK_CATEGORIES.input,
        subcategory: 'trackpad',
        tags: ['trackpad', 'tap', 'click'],
        domain: 'com.apple.driver.AppleBluetoothMultitouch.trackpad',
        key: 'Clicking',
        valueType: 'boolean',
        defaultValue: true,
        command: (value) => `defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -bool ${value}`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Allows tapping on the trackpad to register as a click.',
        lastVerified: '2024-01-15',
    },

    // Security & Privacy
    {
        id: 'gatekeeper-allow-anywhere',
        name: 'Allow Apps from Anywhere',
        description: 'Allow applications from any source (security risk)',
        category: TWEAK_CATEGORIES.security,
        subcategory: 'gatekeeper',
        tags: ['security', 'gatekeeper', 'apps'],
        domain: 'com.apple.LaunchServices',
        key: 'LSQuarantine',
        valueType: 'boolean',
        defaultValue: true,
        command: (value) => `sudo defaults write com.apple.LaunchServices LSQuarantine -bool ${!value}`,
        requiresRestart: false,
        requiresSudo: true,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: false,
        impactLevel: 'high',
        warning: 'This reduces security by allowing apps from unidentified developers. Use with caution.',
        documentation: 'Disables Gatekeeper quarantine for downloaded applications. This is a security risk.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'firewall-stealth',
        name: 'Firewall Stealth Mode',
        description: 'Enable firewall stealth mode (no response to pings)',
        category: TWEAK_CATEGORIES.security,
        subcategory: 'firewall',
        tags: ['firewall', 'network', 'stealth'],
        domain: '/Library/Preferences/com.apple.alf',
        key: 'stealthenabled',
        valueType: 'integer',
        defaultValue: 0,
        command: (value) => `sudo defaults write /Library/Preferences/com.apple.alf stealthenabled -int ${value ? 1 : 0}`,
        requiresRestart: false,
        requiresSudo: true,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'medium',
        documentation: 'Enables firewall stealth mode, making your Mac invisible to ping probes.',
        lastVerified: '2024-01-15',
    },

    // Finder & Files
    {
        id: 'finder-path-bar',
        name: 'Show Path Bar in Finder',
        description: 'Display the full path at the bottom of Finder windows',
        category: TWEAK_CATEGORIES.finder,
        subcategory: 'interface',
        tags: ['finder', 'path', 'navigation'],
        domain: 'com.apple.finder',
        key: 'ShowPathbar',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write com.apple.finder ShowPathbar -bool ${value} && killall Finder`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.5',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Shows the hierarchical path at the bottom of Finder windows.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'finder-status-bar',
        name: 'Show Status Bar in Finder',
        description: 'Display the status bar with file information',
        category: TWEAK_CATEGORIES.finder,
        subcategory: 'interface',
        tags: ['finder', 'status', 'information'],
        domain: 'com.apple.finder',
        key: 'ShowStatusBar',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write com.apple.finder ShowStatusBar -bool ${value} && killall Finder`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Shows the status bar at the bottom of Finder windows with file count and available space.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'default-save-location',
        name: 'Default Save Location',
        description: 'Set default save location to iCloud Drive',
        category: TWEAK_CATEGORIES.finder,
        subcategory: 'defaults',
        tags: ['finder', 'save', 'icloud'],
        domain: 'NSGlobalDomain',
        key: 'NSDocumentSaveNewDocumentsToCloud',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write NSGlobalDomain NSDocumentSaveNewDocumentsToCloud -bool ${value}`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.12',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'medium',
        documentation: 'Sets whether new documents are saved to iCloud Drive by default.',
        lastVerified: '2024-01-15',
    },

    // Safari & Web
    {
        id: 'safari-developer-menu',
        name: 'Enable Safari Developer Menu',
        description: 'Show Develop menu in Safari for web development',
        category: TWEAK_CATEGORIES.safari,
        subcategory: 'development',
        tags: ['safari', 'developer', 'web'],
        domain: 'com.apple.Safari',
        key: 'IncludeDevelopMenu',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write com.apple.Safari IncludeDevelopMenu -bool ${value}`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Enables the Develop menu in Safari with web developer tools.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'safari-debug-menu',
        name: 'Enable Safari Debug Menu',
        description: 'Show Debug menu in Safari for advanced options',
        category: TWEAK_CATEGORIES.safari,
        subcategory: 'development',
        tags: ['safari', 'debug', 'advanced'],
        domain: 'com.apple.Safari',
        key: 'IncludeInternalDebugMenu',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write com.apple.Safari IncludeInternalDebugMenu -bool ${value}`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Enables the internal Debug menu in Safari with additional debugging options.',
        lastVerified: '2024-01-15',
    },

    // Terminal & Shell
    {
        id: 'default-shell-zsh',
        name: 'Set Zsh as Default Shell',
        description: 'Change default shell to Zsh (modern shell)',
        category: TWEAK_CATEGORIES.terminal,
        subcategory: 'shell',
        tags: ['shell', 'zsh', 'terminal'],
        domain: '',
        key: '',
        valueType: 'string',
        defaultValue: '/bin/bash',
        command: () => 'chsh -s /bin/zsh',
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.15',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'medium',
        documentation: 'Sets Zsh as the default shell for the current user. Zsh is the modern default shell in macOS.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'terminal-focus-follows-mouse',
        name: 'Terminal Focus Follows Mouse',
        description: 'Terminal window follows mouse focus',
        category: TWEAK_CATEGORIES.terminal,
        subcategory: 'behavior',
        tags: ['terminal', 'focus', 'mouse'],
        domain: 'com.apple.Terminal',
        key: 'FocusFollowsMouse',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write com.apple.Terminal FocusFollowsMouse -bool ${value}`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Makes terminal windows automatically gain focus when you hover over them.',
        lastVerified: '2024-01-15',
    },

    // Developer Tools
    {
        id: 'show-all-extensions',
        name: 'Show All File Extensions',
        description: 'Display file extensions for all files',
        category: TWEAK_CATEGORIES.development,
        subcategory: 'files',
        tags: ['files', 'extensions', 'development'],
        domain: 'NSGlobalDomain',
        key: 'AppleShowAllExtensions',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write NSGlobalDomain AppleShowAllExtensions -bool ${value}`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Shows file extensions for all files in Finder and dialogs.',
        lastVerified: '2024-01-15',
    },
    {
        id: 'save-panel-expanded',
        name: 'Expanded Save Panels',
        description: 'Always show expanded save dialogs',
        category: TWEAK_CATEGORIES.development,
        subcategory: 'ui',
        tags: ['save', 'dialogs', 'expanded'],
        domain: 'NSGlobalDomain',
        key: 'NSNavPanelExpandedStateForSaveMode',
        valueType: 'boolean',
        defaultValue: false,
        command: (value) => `defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode -bool ${value}`,
        requiresRestart: false,
        requiresSudo: false,
        minMacOSVersion: '10.0',
        compatibleArchitectures: ['arm64', 'x86_64'],
        safeToToggle: true,
        impactLevel: 'low',
        documentation: 'Makes save dialogs always show the expanded view with full file browser.',
        lastVerified: '2024-01-15',
    },
]

// Utility functions
export function searchTweaks(query: string): SystemTweak[] {
    const lowercaseQuery = query.toLowerCase()
    return SYSTEM_TWEAKS.filter(tweak =>
        tweak.name.toLowerCase().includes(lowercaseQuery) ||
        tweak.description.toLowerCase().includes(lowercaseQuery) ||
        tweak.tags.some(tag => tag.toLowerCase().includes(lowercaseQuery))
    )
}

export function getTweaksByCategory(categoryId: TweakCategoryId): SystemTweak[] {
    return SYSTEM_TWEAKS.filter(tweak => tweak.category.id === categoryId)
}

export function filterTweaks(tweaks: SystemTweak[], filters: TweakFilters): SystemTweak[] {
    return tweaks.filter(tweak => {
        if (filters.category && tweak.category.id !== filters.category) return false
        if (filters.impactLevel && tweak.impactLevel !== filters.impactLevel) return false
        if (filters.requiresRestart !== undefined && tweak.requiresRestart !== filters.requiresRestart) return false
        if (filters.requiresSudo !== undefined && tweak.requiresSudo !== filters.requiresSudo) return false
        if (filters.search) {
            const search = filters.search.toLowerCase()
            if (!tweak.name.toLowerCase().includes(search) &&
                !tweak.description.toLowerCase().includes(search) &&
                !tweak.tags.some(tag => tag.toLowerCase().includes(search))) {
                return false
            }
        }
        return true
    })
}

export function getTweakById(id: string): SystemTweak | undefined {
    return SYSTEM_TWEAKS.find(tweak => tweak.id === id)
}

export function generateTweakCommand(tweakId: string, value: boolean | string | number | null): string {
    const tweak = getTweakById(tweakId)
    if (!tweak) return ''
    return tweak.command(value)
}
